(()=>{"use strict";class t{constructor(t,e){let{items:s,renderer:i}=t;this._items=s,this._renderer=i,this._section=document.querySelector(e)}addItems(t){this._section.prepend(t)}renderItems(){var t;null===(t=this._items)||void 0===t||t.forEach((t=>{this._renderer(t)}))}}class e{constructor(t,e,s,i,r,n,o){let{name:a,link:c,_id:l,isLiked:h,owner:d}=t,{hander:u}=s;this._name=a,this._link=c,this._id=l,this._isLiked=h,this._likeCard=i,this._dislikeCard=r,this._cardTemplate=document.querySelector(e),this._cardOpenImage=u,this._popupConfirmation=n,this._cardDelete=o}_getTemplate(){return this._cardTemplate.content.querySelector(".grid__card").cloneNode(!0)}_seteventListener(){this._buttonLike.addEventListener("click",(()=>{this._handleCardLike()})),this._buttonDelete.addEventListener("click",(t=>{this._handleCardDelete(t)})),this._cardImage.addEventListener("click",(()=>{this._cardOpenImage(this._name,this._link)}))}_handleCardLike(){this._isLiked?this._dislikeCard(this._id,(t=>{this._isLiked=t.isLiked,this._buttonLike.classList.toggle("grid__card-button-like-active")})):this._likeCard(this._id,(t=>{this._isLiked=t.isLiked,this._buttonLike.classList.toggle("grid__card-button-like-active")}))}_isCardLiked(){this._isLiked&&this._buttonLike.classList.add("grid__card-button-like-active")}_handleCardDelete(t){this._popupConfirmation.open((()=>{this._cardDelete(this._id),t.target.parentElement.remove()}))}generateCard(){return this._element=this._getTemplate(),this._cardImage=this._element.querySelector(".grid__card-image"),this._cardText=this._element.querySelector(".grid__card-legend"),this._buttonLike=this._element.querySelector(".grid__card-button-like"),this._buttonDelete=this._element.querySelector(".grid__card-button-trash"),this._isCardLiked(),this._cardImage.setAttribute("src",this._link),this._cardImage.setAttribute("alt",this._name),this._cardText.textContent=this._name,this._seteventListener(),this._element}}class s{constructor(t,e){this._config=t,this._formElement=document.getElementById(e),this._inputs=Array.from(this._formElement.querySelectorAll(this._config.input)),this._buttonSubmit=this._formElement.querySelector(this._config.submitButton)}_showInputError(t,e,s){let{errorClass:i,inputErrorClass:r}=s;const n=`#${t.id}-error`,o=this._formElement.querySelector(n);t.classList.add(r),console.log(t,r),o.textContent=e,o.classList.add(i)}_hideInputError(t,e){let{errorClass:s,inputErrorClass:i}=e;const r=`#${t.id}-error`;console.log(r);const n=this._formElement.querySelector(r);t.classList.remove(i),console.log(n),n.textContent="",n.classList.remove(s)}enableValidation(){this._formElement.addEventListener("submit",(t=>{t.preventDefault()})),this._setEventListeners()}_hasInvalidInput(){return this._inputs.some((t=>!t.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonSubmit.disabled=!0,this._buttonSubmit.classList.add(this._config.buttonDisabledClass)):(this._buttonSubmit.disabled=!1,this._buttonSubmit.classList.remove(this._config.buttonDisabledClass))}_checkInputValidity(t){t.validity.valid?this._hideInputError(t,{errorClass:this._config.errorClass,inputErrorClass:this._config.inputErrorClass}):this._showInputError(t,t.validationMessage,{errorClass:this._config.errorClass,inputErrorClass:this._config.inputErrorClass})}_setEventListeners(){this._toggleButtonState(),this._inputs.forEach((t=>{t.addEventListener("input",(()=>{this._checkInputValidity(t),this._toggleButtonState()}))}))}}class i{constructor(t){this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}open(){document.addEventListener("keypress",this._handleEscClose),this._popup.classList.add("popup_opened")}close(){document.removeEventListener("keypress",this._handleEscClose),this._popup.classList.remove("popup_opened")}_handleEscClose(t){console.log(t),"Escape"===t.code&&(this.close(),document.addEventListener("keydown",(t=>console.log(`Tecla pressionada: ${t.key}`))))}setEventListeners(){this._popup.querySelector(".popup__close-button").addEventListener("click",(()=>this.close())),this._popup.addEventListener("click",(t=>{t.target.classList.contains("popup_opened")&&this.close()}))}}class r extends i{constructor(t,e,s){super(e),this._submitFormCallback=t,this._popup=document.querySelector(e),this._form=this._popup.querySelector(".form"),this._submitButton=this._popup.querySelector(s.submitButton),this._disabledButton=s.buttonDisabledClass}_getInputValues(){const t=Array.from(this._form.querySelectorAll(".form__input")),e={};return t.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(t=>{t.preventDefault();const e=this._getInputValues();this._submitFormCallback(e)}))}close(){super.close(),this._form.reset()}savingProcess(t){t?(this._submitButton.removeAttribute("disabled"),this._submitButton.classList.remove(this._disabledButton),this._submitButton.textContent="Salvando..."):(this._submitButton.setAttribute("disabled",!0),this._submitButton.classList.add(this._disabledButton),this._submitButton.textContent="")}}const n=new class{constructor(t){let{baseUrl:e,authorization:s}=t;this._baseUrl=e,this._authorization=s}_checkError(t){return console.log(t)}_checkResponse(t){return t.ok?t.json():Promise.reject(`Erro: ${t.status}`)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:{authorization:this._authorization}}).then((t=>this._checkResponse(t))).catch(this._checkError)}userInfoUpdate(t){let{name:e,about:s}=t;return fetch(`${this._baseUrl}/users/me`,{headers:{authorization:this._authorization,"Content-Type":"application/json"},method:"PATCH",body:JSON.stringify({name:e,about:s})}).then((t=>this._checkResponse(t)))}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:{authorization:this._authorization},method:"GET"}).then((t=>this._checkResponse(t)))}createCard(t){let{name:e,link:s}=t;return fetch(`${this._baseUrl}/cards`,{headers:{authorization:this._authorization,"Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:`${e}`,link:`${s}`})}).then((t=>this._checkResponse(t)))}profileImageUpdate(t){return fetch(`${this._baseUrl}/users/me/avatar`,{headers:{authorization:this._authorization,"Content-Type":"application/json"},method:"PATCH",body:JSON.stringify({avatar:t})}).then((t=>this._checkResponse(t)))}deleteCard(t){return fetch(`${this._baseUrl}/cards/${t}`,{headers:{authorization:this._authorization},method:"DELETE"}).then((t=>this._checkResponse(t)))}cardLike(t){return fetch(`${this._baseUrl}/cards/${t}/likes`,{headers:{authorization:this._authorization},method:"PUT"}).then((t=>this._checkResponse(t)))}deleteLike(t){return fetch(`${this._baseUrl}/cards/${t}/likes`,{headers:{authorization:this._authorization},method:"DELETE"}).then((t=>this._checkResponse(t)))}}({baseUrl:"https://around-api.pt-br.tripleten-services.com/v1",authorization:"1042dbaa-1f1e-4873-a497-11bd407a55f0"});let o;n.getInitialCards().then((e=>{o=new t({items:e,renderer:p},".grid"),o.renderItems()}));const a=new class{constructor(t){let{name:e,about:s,avatar:i}=t;this._name=document.querySelector(e),this._about=document.querySelector(s),this._avatar=document.querySelector(i)}getUserInfo(){return{name:this._name.textContent,about:this._about.textContent}}setUserInfo(t){let{name:e,about:s}=t;this._name.textContent=e,this._about.textContent=s}setUserAvatar(t){let{avatar:e}=t;this._avatar.src=e}}({name:"#proname",about:"#protext",avatar:"#profile__avatar"}),c={form:".form",input:".form__input",submitButton:".form__submit-button",buttonDisabledClass:"form__submit-button-inactive",errorClass:"form__error-invalid",inputErrorClass:".form__input-invalid"},l=new r((t=>{l.savingProcess(!0),n.userInfoUpdate(t).then((t=>{a.setUserInfo(t),l.savingProcess(!1),l.close()})).catch((t=>{console.log(t),l.savingProcess(!1),l.close()}))}),".popup_type_edit-profile",c);l.setEventListeners(),n.getUserInfo().then((t=>{a.setUserInfo(t),a.setUserAvatar(t)})).catch((t=>console.log(t)));const h=new class extends i{constructor(t,e){super(t),this._buttonConfirm=document.querySelector(".form__submit-button-confirmation"),this._cardDelete=e}open(t){super.open(),this._removeCard=t,this._buttonConfirm.addEventListener("click",this._removeCard)}}(".popup_type_confirmation");function d(t){n.deleteCard(t).then((()=>{h.close()})).catch((t=>console.log(t))),h.close()}function u(t,e){n.cardLike(t).then((t=>{e(t)})).catch((t=>console.log(t)))}function _(t,e){n.deleteLike(t).then((t=>e(t))).catch((t=>console.log(t)))}function p(t){const s=new e(t,"#card-template",{hander:(t,e)=>E.open(t,e)},u,_,h,d);o.addItems(s.generateCard())}h.setEventListeners();const m=new r((function(t){m.savingProcess(!0),n.createCard(t).then((t=>{const s=new e(t,"#card-template",{hander:(t,e)=>E.open(t,e)},u,_,h,d).generateCard();o.addItems(s),m.savingProcess(!1),m.close()})).catch((t=>{console.log(t),m.savingProcess(!1),m.close()}))}),".popup_type_add-card",c);m.setEventListeners();const b=new r((function(t){b.savingProcess(!0),n.profileImageUpdate(t.avatar).then((t=>{a.setUserAvatar(t),b.savingProcess(!1),b.close()})).catch((t=>{console.log(t),b.savingProcess(!1),b.close()}))}),".popup_type_edit-avatar",c);b.setEventListeners();const v=document.querySelector(".profile__button-fill"),g=document.querySelector("#profile"),f=document.querySelector(".profile__avatar-edit-button");v.addEventListener("click",(()=>{m.open()})),g.addEventListener("click",(()=>{l.open()})),f.addEventListener("click",(()=>{b.open()}));const E=new class extends i{constructor(t){super(t),this._imageElement=this._popup.querySelector(".popup__image"),this._captionElement=this._popup.querySelector(".popup__title")}open(t,e){this._imageElement.setAttribute("src",e),this._imageElement.setAttribute("alt",t),this._captionElement.textContent=t,super.open()}close(){super.close(),document.removeEventListener("keypress",this._handleEscClose)}setEventListeners(){super.setEventListeners()}}(".popup_type_view-card");E.setEventListeners();const k=new s(c,"form-values"),L=new s(c,"editp"),C=new s(c,"avatarform");k.enableValidation(),L.enableValidation(),C.enableValidation()})();
//# sourceMappingURL=main.0642c53b.js.map